<mvc:View
  controllerName="lojacap.controller.nota-fiscal" 
  xmlns:mvc="sap.ui.core.mvc"
  xmlns="sap.m"
  xmlns:core="sap.ui.core">

    <Page id="pgMonitor" showHeader="false" footer="{footerToolbar}">
    <footer>
            <Toolbar id="footerToolbar" visible="{totalModel>/mostrarTotais}">
                <ToolbarSpacer id="frrf"/>
                
                <HBox id="fgv" visible="{totalModel>/bruto/visible}" class="sapUiMediumMarginEnd">
                    <Label id="grg" text="Total Bruto:" class="sapUiSmallMarginEnd"/>
                    <Text id="tgrg" text="{totalModel>/bruto/value}" class="sapMObjectNumber"/>
                </HBox>
                
                <HBox id="er" visible="{totalModel>/liquido/visible}" class="sapUiMediumMarginEnd">
                    <Label id="gtg" text="Total Líquido:" class="sapUiSmallMarginEnd"/>
                    <Text id="mnju" text="{totalModel>/liquido/value}" class="sapMObjectNumber"/>
                </HBox>
                
                <HBox id="hny" visible="{totalModel>/frete/visible}" class="sapUiMediumMarginEnd">
                    <Label id="ght" text="Total Frete:" class="sapUiSmallMarginEnd"/>
                    <Text id="jjy" text="{totalModel>/frete/value}" class="sapMObjectNumber"/>
                </HBox>
            </Toolbar>
        </footer>

    <VBox id="vboxNotaFiscalMonitor">

        <Toolbar id="toolbarCabecalhoTopoNf" class="cabecalhoTopo">
            <HBox id="hboxCabecalhoNf" width="100%" alignItems="Center" justifyContent="SpaceBetween">
                <HBox id="hboxEsquerdaNf" alignItems="Center">
                    <Button id="btnVoltarTopoNf"
                            icon="sap-icon://nav-back"
                            type="Transparent"
                            tooltip="Voltar"/>
                    <Image id="logoTopoNf"
                          src="https://upload.wikimedia.org/wikipedia/commons/5/59/SAP_2011_logo.svg"
                          height="2rem"
                          width="auto"
                          class="sapUiTinyMarginBegin" />
                </HBox>
                <HBox id="hboxCentroNf" width="100%" justifyContent="Center">
                    <Text id="tituloCabecalhoNf"
                          text="GBLOG - Plataforma Logística - Detalhamento Documentos"
                          class="cabecalhoTexto" />
                </HBox>
                <HBox id="hboxDireitaNf" width="2rem" />
            </HBox>
        </Toolbar>

        <Toolbar id="toolbarAcoesNfse" class="sapUiSmallMarginBottom">
            <HBox id="hboxFiltrosAcoesNfse" alignItems="Center" wrap="Wrap" renderType="Bare">
                <Input id="inputFiltroNfse" placeholder="Buscar NFSe..." width="12rem" />
                <Button id="btnProximaEtapaNfse" icon="sap-icon://arrow-right" text="Próxima etapa" class="sapUiTinyMarginEnd" press=".onProximaEtapa"/>
                <ToolbarSeparator id="separador1"/>
                <Button id="btnVoltarEtapaNfse" icon="sap-icon://arrow-left" text ="Voltar etapa" class="sapUiTinyMarginEnd" press=".onVoltarEtapa"/>
                <ToolbarSeparator id="separador2"/>
                <Button id="btnRejeitarNfse" icon="sap-icon://employee-rejections" text="Rejeitar Frete" class="sapUiTinyMarginEnd" press=".onRejeitarFrete" />
                <ToolbarSeparator id="separador3"/>
                <Button id="btnFreteManual" icon="sap-icon://display" text="Adicionar Frete Manual" class="sapUiTinyMarginEnd" press=".onAbrirDialogoCriacao" />
                <ToolbarSeparator id="separador4"/>
                <Button id="btnUpload" icon="sap-icon://add-document" text="Upload Arquivo de Frete" class="sapUiTinyMarginEnd" press=".onOpenUploadDialog" />
                <ToolbarSeparator id="separador5"/>
                <Button id="btnAtualizarNfse" text="Atualizar" icon="sap-icon://refresh" class="sapUiTinyMarginEnd" press="onAtualizar" />
                <ToolbarSeparator id="separador6"/>
                <Button id="btnVerLogsNfse" icon="sap-icon://newspaper" text="Ver logs" class="sapUiTinyMarginEnd" press="onLogPress" />
                <ToolbarSeparator id="separador7"/>
                <MenuButton id="btnMais" text="Mais">
			        <menu>
				        <Menu id="btnMenuMais" itemSelected="onMenuAction">
					    <MenuItem id="btnMaisEdit" text="Edit" icon="sap-icon://edit" />
					    <MenuItem id="btnMaisSave" text="Save" icon="sap-icon://save" />
					    <MenuItem id="btnOpen" text="Open" icon="sap-icon://open-folder" />
				        </Menu>
			        </menu>
		        </MenuButton>
            </HBox>
        </Toolbar>

        <Toolbar id="toolbarIconesFiltrosNfse" class="sapUiTinyMarginBottom">
            <HBox id="hboxIconesFiltrosNfse" alignItems="Center" renderType="Bare">
                <Button id="filtroIconeTodosNfse"
                        icon="sap-icon://sys-enter" 
                        type="Ghost"
                        tooltip="Todas as NFSe"
                        class="sapUiTinyMargin" />

                    <ToolbarSeparator id="separador8"/> 

                <Button id="filtroIconeNaoAtribuidasNfse"
                        icon="sap-icon://sort-ascending" 
                        type="Ghost"
                        tooltip="Status: Não Atribuída (01)"
                        class="sapUiTinyMargin"
                        press=".onPressAscending" />

                <Button id="filtroIconeAtribuidasNfse"
                        icon="sap-icon://sort-descending" 
                        type="Ghost"
                        tooltip="Status: Atribuída (05)"
                        press=".onPressDescending" />

                <Button id="filtroIconeErroNfse"
                        icon="sap-icon://search" 
                        type="Ghost"
                        tooltip="Status: Erro (99)"
                        class="sapUiTinyMargin"
                        press="onFilterNfComErro" />

                <Button id="filtroIconeFinalizadoPLNfse"
                        icon="sap-icon://sys-add"
                        type="Ghost"
                        tooltip="Status: Processo Finalizado - Retorno PL (50)" />

                <MenuButton id="menuFiltro" class="sapUiTinyMargin" icon="sap-icon://filter" buttonMode="Split" defaultAction="onDefaultAction" beforeMenuOpen="onBeforeMenuOpen">
                    <menu>
                        <Menu id="menuFiltroSelect" itemSelected="onMenuAction">
                        <MenuItem id="menuFiltrofiltro" text="Filter" icon="sap-icon://filter" press="openFilterDialog" />                
                        <MenuItem id="menuFiltroSelect1" text="Edit" icon="sap-icon://edit" />
                        <MenuItem id="menuFiltroSelect2" text="Save" icon="sap-icon://save" />
                        <MenuItem id="menuFiltroSelect3" text="Open" icon="sap-icon://open-folder" />
                        </Menu>
                    </menu>
                </MenuButton>

                    <ToolbarSeparator id="separador9" /> 

                 <MenuButton id="menuSomar" 
                            icon="sap-icon://sum" 
                            tooltip="Calcular Totais"
                            class="sapUiTinyMargin">
                    <menu>

                        <Menu id="ffe" itemSelected=".onCalcularTotal">
                            <MenuItem id="ef" text="Valor Total Bruto" icon="sap-icon://money-bills">
                                <customData>
                                    <core:CustomData key="coluna" value="valorBrutoNfse" />
                                </customData>
                            </MenuItem>
                            <MenuItem id="hbhb" text="Valor Total Líquido" icon="sap-icon://receipt">
                                <customData>
                                    <core:CustomData key="coluna" value="valorLiquidoFreteNfse" />
                                </customData>
                            </MenuItem>
                            <MenuItem id="eg" text="Valor Total Frete" icon="sap-icon://shipping-status">
                                <customData>
                                    <core:CustomData key="coluna" value="valorEfetivoFrete" />
                                </customData>
                            </MenuItem>
                            
                            <MenuItem id="fhgh" text="Calcular Todos os Totais" icon="sap-icon://multiselect-all">
                                <customData>
                                    <core:CustomData key="coluna" value="todos" />
                                </customData>
                            </MenuItem>

                            <MenuItem id="fhgha2" text="limpar" icon="sap-icon://clear-all">
                                <customData>
                                    <core:CustomData key="coluna" value="limpartodos" />
                                </customData>
                            </MenuItem>

                        </Menu>
                    </menu>
                </MenuButton>

                <MenuButton id="menuSomar2" class="sapUiTinyMarginEnd" icon="sap-icon://sum" buttonMode="Split" defaultAction="onDefaultAction" beforeMenuOpen="onBeforeMenuOpen">
                    <menu>
                        <Menu id="menuSomar2Select" itemSelected="onMenuAction">
                        <MenuItem id="menuSomar2Select1" text="Edit" icon="sap-icon://edit" />
                        <MenuItem id="menuSomar2Select2" text="Save" icon="sap-icon://save" />
                        <MenuItem id="menuSomar2Select3" text="Open" icon="sap-icon://open-folder" />
                        </Menu>
                    </menu>
                </MenuButton>

                <ToolbarSeparator id="separador10"/>

                <Button id="filtroIconeFinalizadoPLNfseas"
                        icon="sap-icon://print"
                        type="Ghost"
                        tooltip="Imprimir"
                        class="sapUiTinyMargin"
                        press=".onPressPrint"/>

                <MenuButton id="btnMadis" icon="sap-icon://detail-view" type="Ghost">
			        <menu>
				        <Menu id="btnMenudMais" itemSelected="onMenuAction">
					    <MenuItem id="btnMaidsEdit" text="Edit" icon="sap-icon://edit" />
					    <MenuItem id="btnMaisdSave" text="Save" icon="sap-icon://save" />
					    <MenuItem id="btnOpefdn" text="Open" icon="sap-icon://open-folder" />
				        </Menu>
			        </menu>
		        </MenuButton>

                <MenuButton id="btnMaias" icon="sap-icon://sys-next-page" type="Ghost" class="sapUiTinyMargin">
			        <menu>
				        <Menu id="btnMenuMaias" itemSelected="onMenuAction">
					    <MenuItem id="btnMaisEdiat" text="Edit" icon="sap-icon://edit" />
					    <MenuItem id="btnMaisSavae" text="Save" icon="sap-icon://save" />
					    <MenuItem id="btnOpena" text="Open" icon="sap-icon://open-folder" />
				        </Menu>
			        </menu>
		        </MenuButton>

                <MenuButton id="menuGrid" class="sapUiTinyMarginEnd" icon="sap-icon://provision" buttonMode="Split" defaultAction="onDefaultAction" beforeMenuOpen="onBeforeMenuOpen">
                    <menu>
                        <Menu id="menuGridSelect" itemSelected="onMenuAction">
                        <MenuItem id="menuGridSelect1" text="Edit" icon="sap-icon://edit" />
                        <MenuItem id="menuGridSelect2" text="Save" icon="sap-icon://save" />
                        <MenuItem id="menuGridSelect3" text="Open" icon="sap-icon://open-folder" />
                        </Menu>
                    </menu>
                </MenuButton>

                <ToolbarSeparator id="separador11"/>

                <Button id="filtroIconeFinalizadoPLNfsae"
                        icon="sap-icon://message-information"
                        type="Ghost"
                        tooltip="Status: Processo Finalizado - Retorno PL (50)" 
                        class="sapUiTinyMargin"/>

                        <Button id="chamadaapi"
                        icon="sap-icon://sys-enter" 
                        tooltip="Todas as NFSe"
                        class="sapUiTinyMargin"
                        press = "onCallApi" />
            </HBox>
        </Toolbar>

        <Table
            id="tableNotaFiscalServicoMonitor"
            items="{/NotaFiscalServicoMonitor}"
            mode="MultiSelect"
            updateFinished=".onUpdateFinishedNotaFiscal"
            selectionChange=".onSelectionChange"
            growing="true"  class="tabelaComBorda">


            <columns>
                <Column id="colLogIconsNfse" hAlign="Center" width="3rem">
                    <Text id="txtColLogIconsNfse" text="Log" />
                </Column>
                <Column id="colIdAlocacaoSAP">
                    <Text id="txtColIdAlocacaoSAP" text="ID Aloc. SAP" />
                </Column>
                <Column id="colOrderIdPL">
                    <Text id="txtColOrderIdPL" text="Order ID PL" />
                </Column>
                <Column id="colChaveDocumentoMae">
                    <Text id="txtColChaveDocumentoMae" text="Chave Doc. Mãe" />
                </Column>
                <Column id="colChaveDocumentoFilho">
                    <Text id="txtColChaveDocumentoFilho" text="Chave Doc. Filho" />
                </Column>
                <Column id="colStatusNfse">
                    <Text id="txtColStatusNfse" text="Status Proc." />
                </Column>
                <Column id="colNumeroNfseServico">
                    <Text id="txtColNumeroNfseServico" text="Nº NFS-e" />
                </Column>
                <Column id="colSerieNfseServico">
                    <Text id="txtColSerieNfseServico" text="Série NFS-e" />
                </Column>
                <Column id="colDataEmissaoNfseServico">
                    <Text id="txtColDataEmissaoNfseServico" text="Dt. Emissão NFS-e" />
                </Column>
                <Column id="colChaveAcessoNfseServico" width="20rem">
                    <Text id="txtColChaveAcessoNfseServico" text="Chave Acesso NFS-e" />
                </Column>
                <Column id="colCodigoVerificacaoNfse">
                    <Text id="txtColCodigoVerificacaoNfse" text="Cód. Verificação" />
                </Column>
                <Column id="colNumeroDocumentoMIRO">
                    <Text id="txtColNumeroDocumentoMIRO" text="Nº Doc. MIRO" />
                </Column>
                <Column id="colvalorBrutoNfse">
                    <Text id="txtColvalorBrutoNfse" text="Valor Bruto Nfse" />
                </Column>
                <Column id="colvalorLiquidoFreteNfse">
                    <Text id="txtcolvalorLiquidoFreteNfse" text="valor Liquido FreteNfse" />
                </Column>
                <Column id="colvalorEfetivoFrete">
                    <Text id="txtcolvalorEfetivoFrete" text="valorEfetivoFrete" />
                </Column>


            </columns>

            <items>
                <ColumnListItem id="itemNotaFiscalServicoMonitor" type="Active" 
                highlight="{= ${status} === '50' ? 'Success' : (${status} === '55' || ${status} === '99' ? 'Error' : 'None') }">
                    <cells>
                        <HBox id="hboxLogIconsCellNfse" justifyContent="Start" renderType="Bare">
                            <core:Icon
                            id = "umidai"
                            src="{path:'tipoMensagemErro', formatter:'.formatter.iconTipo'}"
                            color="{path:'tipoMensagemErro', formatter:'.formatter.colorTipo'}"
                            size="0.8rem"/>
                        </HBox>
                        <Text id="txtCellIdAlocacaoSAP" text="{idAlocacaoSAP}" />
                        <Text id="txtCellOrderIdPL" text="{orderIdPL}" />
                        <Text id="txtCellChaveDocumentoMae" text="{chaveDocumentoMae}" />
                        <Text id="txtCellChaveDocumentoFilho" text="{chaveDocumentoFilho}" />
                        <ObjectStatus
                            id="objStatusCellNfse"
                            text="{status} - {parts: [{path: 'status'}], formatter: '.formatter.formatStatusNfseText'}"
                            state="{parts: [{path: 'status'}], formatter: '.formatter.formatStatusNfseState'}" />
                        <Text id="txtCellNumeroNfseServico" text="{numeroNfseServico}" />
                        <Text id="txtCellSerieNfseServico" text="{serieNfseServico}" />
                        <Text id="txtCellDataEmissaoNfseServico" text="{path: 'dataEmissaoNfseServico'}" />
                        <Text id="txtCellChaveAcessoNfseServico" text="{chaveAcessoNfseServico}" />
                        <Text id="txtCellCodigoVerificacaoNfse" text="{codigoVerificacaoNfse}" />
                        <Text id="txtCellNumeroDocumentoMIRO" text="{numeroDocumentoMIRO}" />
                         <Text id="txtCellvalorBrutoNfse" text="{valorBrutoNfse}" />
                          <Text id="txtvalorLiquidoFreteNfse" text="{valorLiquidoFreteNfse}" />
                           <Text id="txtvalorEfetivoFrete" text="{valorEfetivoFrete}" />                   
                    </cells>
                </ColumnListItem>
            </items>
            
        </Table>
    </VBox>
</Page>

</mvc:View>
    